<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="school.DifficultSubjectsChart">
        <div class="o_difficult_subjects_chart">
            <t t-if="hasData">
                <div class="row g-4">
                    <!-- Chart on the left -->
                    <div class="col-lg-7">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-gradient-primary text-white">
                                <i class="fa fa-exclamation-triangle me-2"/>
                                Top 10 Materias con Mayor Dificultad
                            </div>
                            <div class="card-body">
                                <div class="chart-container" t-att-style="'height: ' + (subjects.length * 35 + 50) + 'px'">
                                    <canvas t-ref="canvas"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Table on the right -->
                    <div class="col-lg-5">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-gradient-secondary text-white">
                                <i class="fa fa-table me-2"/>
                                Detalle de Materias
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Materia</th>
                                                <th class="text-center">Reprobados</th>
                                                <th class="text-center">Total</th>
                                                <th class="text-center">Promedio</th>
                                                <th class="text-center">Dificultad</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="subjects" t-as="subject" t-key="subject.subject_id">
                                                <tr>
                                                    <td>
                                                        <i class="fa fa-book me-2 text-muted"/>
                                                        <t t-esc="subject.subject_name"/>
                                                    </td>
                                                    <td class="text-center text-danger fw-bold">
                                                        <t t-esc="subject.failed_students"/>
                                                    </td>
                                                    <td class="text-center">
                                                        <t t-esc="subject.total_students"/>
                                                    </td>
                                                    <td class="text-center">
                                                        <t t-esc="subject.average"/>/20
                                                    </td>
                                                    <td class="text-center">
                                                        <span t-attf-class="badge {{ getDifficultyClass(subject.failure_rate) }}">
                                                            <t t-esc="getDifficultyLabel(subject.failure_rate)"/>
                                                        </span>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
            
            <!-- Empty state -->
            <t t-else="">
                <div class="alert alert-success text-center">
                    <i class="fa fa-check-circle me-2"/>
                    ¡Excelente! No hay materias con alta tasa de reprobación.
                </div>
            </t>
        </div>
    </t>
</templates>
