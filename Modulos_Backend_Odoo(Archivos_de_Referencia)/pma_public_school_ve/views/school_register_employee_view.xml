<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- =====================================================
         VISTA KANBAN - Empleados Escolares
         ===================================================== -->
    <record id="school_register_hr_employee_view_kanban" model="ir.ui.view">
        <field name="name">school.register.hr.employee.view.kanban</field>
        <field name="model">hr.employee</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <kanban class="o_hr_employee_kanban" sample="1" duplicate="false">
                <field name="show_hr_icon_display"/>
                <field name="image_128"/>
                <field name="company_id"/>
                <field name="school_employee_type"/>
                <field name="situacion_trabajador"/>
                <templates>
                    <t t-name="card" class="flex-row">
                        <aside class="o_kanban_aside_full">
                            <t t-if="record.image_1024.raw_value">
                                <field name="image_1024" widget="background_image" options="{'zoom': true, 'zoom_delay': 1000, 'preview_image':'image_128'}" class="d-block position-relative"/>
                            </t>
                            <t t-elif="record.image_128.raw_value">
                                <field name="avatar_128" widget="background_image" options="{'zoom': true, 'zoom_delay': 1000}" class="d-block position-relative"/>
                            </t>
                            <div t-else="" class="d-flex align-items-center justify-content-center bg-100 bg-gradient">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-75 h-75 opacity-50" viewBox="0 0 20 20">
                                    <g fill="currentColor">
                                        <path d="M 10 11 C 4.08 11 2 14 2 16 L 2 19 L 18 19 L 18 16 C 18 14 15.92 11 10 11 Z"/>
                                        <circle cx="10" cy="5.5" r="4.5"/>
                                    </g>
                                </svg>
                            </div>
                        </aside>
                        <main class="ms-2">
                            <div>
                                <div t-if="record.show_hr_icon_display.raw_value" class="float-end">
                                    <field name="hr_icon_display" widget="hr_presence_status"/>
                                </div>
                                <field class="fw-bold fs-5" name="name" placeholder="Nombre del Empleado"/>
                            </div>
                            <div t-if="record.school_employee_type.raw_value" class="text-truncate">
                                <i class="fa fa-fw me-2 fa-user-circle text-primary" title="Tipo de Empleado"/>
                                <field name="school_employee_type"/>
                            </div>
                            <div t-if="record.job_title.raw_value" class="text-truncate">
                                <i class="fa fa-fw me-2 fa-suitcase text-primary" title="Cargo"/>
                                <field name="job_title"/>
                            </div>
                            <div t-if="record.work_phone.raw_value">
                                <i class="fa fa-fw me-2 fa-phone text-primary" title="Teléfono"/>
                                <field name="work_phone"/>
                            </div>
                            <div t-if="record.situacion_trabajador.raw_value">
                                <field name="situacion_trabajador" widget="badge" 
                                    decoration-success="situacion_trabajador == 'activo'"
                                    decoration-warning="situacion_trabajador in ['reposo', 'permiso']"
                                    decoration-danger="situacion_trabajador in ['suspendido', 'retirado']"
                                    decoration-info="situacion_trabajador in ['jubilado', 'otro']"/>
                            </div>
                            <field class="hr_tags" name="category_ids" widget="many2many_tags" options="{'color_field': 'color'}" optional="hide"/>
                        </main>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- =====================================================
         VISTA FORM - Empleados Escolares (desde cero)
         ===================================================== -->
    <record id="school_hr_employee_form_view" model="ir.ui.view">
        <field name="name">school.hr.employee.form.view</field>
        <field name="model">hr.employee</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <form string="Empleado Escolar">
                <header groups="hr.group_hr_user">
                        <button name="action_create_user" type="object" class="btn btn-primary" invisible="user_id" groups="hr.group_hr_user" context="{'default_create_employee': True}"/>
                </header>
                <sheet>
                    <div name="button_box" class="oe_button_box">
                            <!-- <button name="action_open_versions" class="oe_stat_button" icon="fa-address-book" type="object" groups="hr.group_hr_user">
                                <div class="o_stat_info">
                                    History
                                    <span class="o_stat_value">
                                        <field name="versions_count"/>
                                    </span>
                                </div>
                            </button> -->
                        </div>
                        <div class="d-flex flex-column flex-sm-row align-items-center">
                            <div class="o_employee_avatar ms-2 p-0">
                                <field name="image_1920" widget="image" class="m-0" options="{&quot;size&quot;: [128,158], &quot;zoom&quot;: true, &quot;preview_image&quot;:&quot;avatar_128&quot;}"/>
                                <field name="show_hr_icon_display" invisible="1"/>
                            </div>
                            <div class="col-12 col-sm-6 col-md-7 col-lg-8 px-4">
                                <div class="oe_title mw-100 ps-0 pe-sm-2">
                                    <h1 class="d-flex flex-row align-items-center">
                                        <field name="name" placeholder="Employee's Name" required="True" style="font-size: min(4vw, 2.6rem);"/>
                                    </h1>
                                    <h5 class="d-flex align-items-baseline mb-0">
                                        <i class="fa fa-envelope fa-fw me-1 text-primary" title="Work Email"/>
                                        <field name="work_email" widget="email" placeholder="e.g. johndoe@example.com" string="Work Email" class="w-100 w-sm-75"/>
                                    </h5>
                                    <h5 class="d-flex align-items-baseline mb-0">
                                        <i class="fa fa-phone fa-fw me-1 text-primary" title="Work Phone"/>
                                        <field name="work_phone" widget="phone" placeholder="Work Phone" string="Work Phone" class="w-100 w-sm-75"/>
                                    </h5>
                                    <h5 class="d-flex align-items-baseline mb-0">
                                        <i class="fa fa-mobile fa-fw me-1 text-primary" title="Work Mobile"/>
                                        <field name="mobile_phone" widget="phone" placeholder="Work Mobile" string="Work Mobile" class="w-100 w-sm-75"/>
                                    </h5>
                                    <h5>
                                        <i class="fa fa-tags fa-fw me-1 text-primary" title="Tags"/>
                                        <field name="category_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}" placeholder="e.g. Founder, Motorized, Building B, ..." groups="hr.group_hr_user"/>
                                    </h5>
                                </div>
                            </div>
                            <div class="align-self-start w-auto end-0 mt-2 d-flex align-items-center justify-content-end gap-2 o_presence_status_pill_wrapper">
                                <div invisible="not user_id">
                                    <widget name="hr_employee_chat" invisible="not context.get('chat_icon')"/>
                                </div>
                                <field name="hr_icon_display" invisible="not show_hr_icon_display or not id" widget="hr_presence_status"/>
                                
                            </div>
                        </div>
                        <widget name="web_ribbon" title="Archived" bg_color="text-bg-danger" invisible="active"/>
                        <field name="employee_properties" columns="2"/>


                    <!-- ===== NOTEBOOK CON PESTAÑAS ===== -->
                    <notebook>
                        <!-- ===== PESTAÑA: Matrícula de Personal ===== -->
                        <page name="matricula_personal" string="Matrícula de Personal">
                            <group>
                                <group string="Tipo de Personal">
                                    <field name="school_employee_type" required="1"/>
                                    <field name="job_title" string="Cargo"/>
                                    <field name="department_id"/>
                                    <field name="situacion_trabajador"/>
                                    <field name="especifique_situacion" 
                                        invisible="situacion_trabajador != 'otro'"
                                        required="situacion_trabajador == 'otro'"/>
                                </group>
                                <group string="Datos del Personal">
                                    <field name="identification_id" string="Cédula"/>
                                    <field name="sex" string="Sexo"/>
                                    <field name="codigo_rac"/>
                                    <field name="horas_academicas"/>
                                    <field name="horas_administrativas"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Ubicación Geográfica">
                                    <label for="private_street" string="Dirección"/>
                                    <div class="o_address_format">
                                        <field name="private_street" placeholder="Calle..." class="o_address_street"/>
                                        <field name="municipio" placeholder="Municipio" class="o_address_street"/>
                                        <field name="parroquia" placeholder="Parroquia"  class="o_address_city"/>
                                        <field name="allowed_country_state_ids" invisible="1"/>
                                        <field name="private_state_id" class="o_address_state" placeholder="Estado" 
                                            options='{"no_open": True, "no_create": True}' 
                                            context="{'default_country_id': private_country_id}"
                                            domain="[('id', 'in', allowed_country_state_ids)]"/>
                                        <field name="cod_estado" placeholder="Código de Estado" class="o_address_zip"/>
                                        <field name="private_zip" placeholder="Código Postal" class="o_address_zip"/>
                                        <field name="private_country_id" placeholder="País" class="o_address_country" 
                                            options='{"no_open": True, "no_create": True}'/>
                                    </div>
                                    <field name="ubicacion_geografica"/>
                                </group>
                                <group string="Códigos del Plantel">
                                    <field name="codigo_dependencia"/>
                                    <field name="codigo_estadistico"/>
                                    <field name="codigo_plantel"/>
                                    <field name="nombre_plantel_nomina"/>
                                    <field name="fecha_ingreso_plantel"/>
                                </group>
                            </group>
                            
                            <group>
                                <group string="Turnos">
                                    <field name="turno_manana"/>
                                    <field name="turno_tarde"/>
                                </group>
                                <group string="Nivel y Modalidad">
                                    <field name="nivel_educativo_ids" widget="many2many_tags"/>
                                    <field name="modalidad_ids" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>

                        <!-- ===== PESTAÑA: Asignación Académica (solo docentes) ===== -->
                        <page name="asignacion_academica" string="Asignación Académica" invisible="school_employee_type != 'docente'">
                            <group>
                                <group string="Secciones/Grados que Imparte" colspan="2">
                                    <field name="secciones_imparte_ids" nolabel="1" widget="many2many_tags" colspan="2"/>
                                </group>
                            </group>
                            
                            <group string="Para Media General y Técnica">
                                <group>
                                    <field name="especialidad_docente"/>
                                    <field name="secciones_que_imparte"/>
                                </group>
                            </group>
                            
                            <group string="Para Especial/Jóvenes y Adultos">
                                <group>
                                    <field name="materia_especialidad"/>
                                    <field name="periodo_grupo"/>
                                </group>
                            </group>
                            
                            <group string="Materias Asignadas">
                                <field name="subject_ids" nolabel="1" colspan="2" readonly="1">
                                    <list editable="top" create="0">
                                        <field name="name"/>
                                    </list>
                                </field>
                            </group>
                        </page>

                        <!-- ===== PESTAÑA: Personal (igual que nativo) ===== -->
                        <page name="personal_information" string="Personal">
                            <group>
                                <group string="Contacto Privado">
                                    <field name="private_email" placeholder="ej. miemail@ejemplo.com" string="Email"/>
                                    <field name="private_phone" widget="phone" string="Teléfono"/>
                                </group>
                                <group string="Información Personal" name="hr_birth_group">
                                    <field name="legal_name"/>
                                    <label for="birthday"/>
                                    <div class="o_row" name="div_birthday">
                                        <field name="birthday" class="o_hr_narrow_field"/>
                                        <span>
                                            <label for="birthday_public_display" class="fw-bold text-900 form-check-label ms-3"/>
                                            <field name="birthday_public_display" class="ms-3"/>
                                        </span>
                                    </div>
                                    <label for="place_of_birth"/>
                                    <div class="o_row" name="birth_location">
                                        <field name="place_of_birth" class="oe_inline o_hr_narrow_field" nolabel="1" placeholder="Ciudad"/>
                                        <div class="mx-3 flex-grow-0">─</div>
                                        <field name="country_of_birth" class="oe_inline o_hr_narrow_field" nolabel="1" placeholder="País"/>
                                    </div>
                                </group>
                                <group string="Contacto de Emergencia">
                                    <field name="emergency_contact" string="Contacto"/>
                                    <field name="emergency_phone" class="o_force_ltr" string="Teléfono"/>
                                </group>
                                <group string="Visa y Permiso de Trabajo">
                                    <label for="visa_no"/>
                                    <div class="o_wrap_label d-flex flex-row gap-3 align-items-baseline">
                                        <field name="visa_no"/>
                                        <label for="visa_expire" class="flex-shrink-0" invisible="not visa_no" string="Expira"/>
                                        <field name="visa_expire" invisible="not visa_no"/>
                                    </div>
                                    <label for="permit_no"/>
                                    <div class="o_wrap_label d-flex flex-row gap-3 align-items-baseline">
                                        <field name="permit_no"/>
                                        <label for="work_permit_expiration_date" class="flex-shrink-0" invisible="not permit_no" string="Expira"/>
                                        <field name="work_permit_expiration_date" invisible="not permit_no"/>
                                    </div>
                                    <field name="work_permit_name" invisible="1"/>
                                    <field name="has_work_permit" widget="work_permit_upload" filename="work_permit_name" string="Documento"/>
                                </group>
                                <group name="citizenship" string="Ciudadanía">
                                    <field name="country_id" options='{"no_open": True, "no_create": True}'/>
                                    <label for="passport_id"/>
                                    <div class="o_wrap_label d-flex flex-row gap-3 align-items-baseline">
                                        <field name="passport_id"/>
                                        <label for="passport_expiration_date" class="flex-shrink-0" invisible="not passport_id" string="Expira"/>
                                        <field name="passport_expiration_date" invisible="not passport_id"/>
                                    </div>
                                </group>
                                <group string="Familia" name="hr_family_group">
                                    <field name="marital"/>
                                    <field name="spouse_complete_name" invisible="marital not in ['married', 'cohabitant']"/>
                                    <field name="spouse_birthdate" invisible="marital not in ['married', 'cohabitant']"/>
                                    <field name="children"/>
                                </group>
                                <group string="Educación" name="hr_education_group">
                                    <field name="certificate"/>
                                    <field name="study_field"/>
                                </group>
                            </group>
                        </page>

                        <!-- ===== PESTAÑA: Secciones Actuales ===== -->
                        <page name="secciones_actuales" string="Secciones Actuales">
                            <field name="secciones_imparte_ids" nolabel="1" readonly="1">
                                <list editable="bottom">
                                    <field name="name"/>
                                    <field name="year_id"/>
                                    <field name="current"/>
                                </list>
                            </field>
                        </page>

                        <!-- ===== PESTAÑA: Observaciones ===== -->
                        <page name="observaciones_personal" string="Observaciones">
                            <field name="observacion_personal" placeholder="Escriba aquí cualquier observación relevante sobre el empleado..."/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- =====================================================
         VISTA LISTA - Empleados Escolares
         ===================================================== -->
    <record id="school_register_hr_employee_view_tree" model="ir.ui.view">
        <field name="name">school.register.hr.employee.view.tree</field>
        <field name="model">hr.employee</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <list string="Empleados Escolares" multi_edit="1" sample="1">
                <field name="avatar_128" widget="image" options="{'size': [24, 24], 'img_class': 'rounded-3'}" width="30" nolabel="1"/>
                <field name="name" readonly="1"/>
                <field name="school_employee_type"/>
                <field name="job_title" optional="show"/>
                <field name="department_id" optional="show"/>
                <field name="identification_id" string="Cédula" optional="show"/>
                <field name="nivel_educativo_ids" widget="many2many_tags" optional="show"/>
                <field name="situacion_trabajador" widget="badge"
                    decoration-success="situacion_trabajador == 'activo'"
                    decoration-warning="situacion_trabajador in ['reposo', 'permiso']"
                    decoration-danger="situacion_trabajador in ['suspendido', 'retirado']"/>
                <field name="work_phone" optional="hide"/>
                <field name="work_email" optional="hide"/>
                <field name="horas_academicas" optional="hide"/>
                <field name="horas_administrativas" optional="hide"/>
                <field name="turno_manana" optional="hide"/>
                <field name="turno_tarde" optional="hide"/>
                <field name="active" column_invisible="True"/>
            </list>
        </field>
    </record>

    <!-- =====================================================
         VISTA BÚSQUEDA - Empleados Escolares
         ===================================================== -->
    <!-- <record id="school_register_hr_employee_view_search" model="ir.ui.view">
        <field name="name">school.register.hr.employee.view.search</field>
        <field name="model">hr.employee</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <search string="Buscar Empleados">
                <field name="name" string="Empleado" filter_domain="['|', ('work_email', 'ilike', self), ('name', 'ilike', self)]"/>
                <field name="school_employee_type"/>
                <field name="job_title"/>
                <field name="identification_id" string="Cédula"/>
                <field name="codigo_plantel"/>
                <field name="codigo_rac"/>
                <separator/>
                <filter name="filter_docente" string="Docentes" domain="[('school_employee_type', '=', 'docente')]"/>
                <filter name="filter_administrativo" string="Administrativos" domain="[('school_employee_type', '=', 'administrativo')]"/>
                <filter name="filter_obrero" string="Obreros" domain="[('school_employee_type', '=', 'obrero')]"/>
                <filter name="filter_cenar" string="CENAR" domain="[('school_employee_type', '=', 'cenar')]"/>
                <separator/>
                <filter name="filter_activo" string="Activos" domain="[('situacion_trabajador', '=', 'activo')]"/>
                <filter name="filter_reposo" string="En Reposo" domain="[('situacion_trabajador', '=', 'reposo')]"/>
                <filter name="filter_permiso" string="Con Permiso" domain="[('situacion_trabajador', '=', 'permiso')]"/>
                <filter name="filter_jubilado" string="Jubilados" domain="[('situacion_trabajador', '=', 'jubilado')]"/>
                <separator/>
                <filter name="filter_turno_manana" string="Turno Mañana" domain="[('turno_manana', '=', True)]"/>
                <filter name="filter_turno_tarde" string="Turno Tarde" domain="[('turno_tarde', '=', True)]"/>
                <separator/>
                <field name="nivel_educativo_ids"/>
                <field name="modalidad_ids"/>
                <separator/>
                <filter string="Archivados" name="inactive" domain="[('active', '=', False)]"/>
                <group expand="0" string="Agrupar por">
                    <filter name="group_type" string="Tipo de Empleado" context="{'group_by': 'school_employee_type'}"/>
                    <filter name="group_situacion" string="Situación" context="{'group_by': 'situacion_trabajador'}"/>
                    <filter name="group_nivel" string="Nivel Educativo" context="{'group_by': 'nivel_educativo_ids'}"/>
                    <filter name="group_modalidad" string="Modalidad" context="{'group_by': 'modalidad_ids'}"/>
                </group>
            </search>
        </field>
    </record> -->

    <!-- =====================================================
         ACCIÓN - Empleados Escolares
         ===================================================== -->
    <record id="school_register_hr_employee_action" model="ir.actions.act_window">
        <field name="name">Empleados Escolares</field>
        <field name="res_model">hr.employee</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_ids" eval="[(5, 0, 0), 
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('school_register_hr_employee_view_kanban')}), 
            (0, 0, {'view_mode': 'list', 'view_id': ref('school_register_hr_employee_view_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('school_hr_employee_form_view')})
        ]"/>
        <!-- <field name="search_view_id" ref="school_register_hr_employee_view_search"/> -->
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crear un nuevo empleado escolar
            </p>
            <p>
                Agregue información del personal docente, administrativo y obrero.
            </p>
        </field>
    </record>

</odoo>
